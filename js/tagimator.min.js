/**
 * jQuery tagimator
 *
 * @version 1.2
 *
 * @author Noah Laux (noahlaux@gmail.com)
 *
 * @dependency
 *  jquery
 *  jquery.effects.core.js
 */
(function(b,c){var a={init:function(d){a.settings=b.extend({speed:1000,fx:"fade",easing:"easeInOutCubic",method:"show"},d);if(d){a.onBeforeStep=(d.onBeforeStep)?d.onBeforeStep:null;
a.onAfterStep=(d.onAfterStep)?d.onAfterStep:null;a.onFinish=(d.onFinish)?d.onFinish:null;}return this;},show:function(){var f=b(this).filter("[data-fx]"),e=(f.length===0)?b(this).find("[data-fx]").not(".fxApplied"):f.not(".fxApplied"),d=a.createFxStack(e);
b(e).not(".fxApplied").hide();a.parseSteps("show",d);},hide:function(){var f=b(this).filter(".fxApplied[data-fx]"),e=(f.length===0)?b(this).find(".fxApplied"):f,d=a.reverseStack(a.createFxStack(e));
a.parseSteps("hide",d);},reset:function(){b(this.children()).removeClass("fxApplied");},parseSteps:function(f,d){var e=b({});b.each(d,function(h,g){e.queue("transitions",function(i){if(a.onBeforeStep){a.onBeforeStep(h,g);
}b.when(a.transitions(g,f)).done(function(){if(a.onAfterStep){a.onAfterStep(h,g);}i();}).fail(function(k,j){console.log(k,j);});});});e.queue("transitions",function(){if(a.onFinish){a.onFinish();
}});e.dequeue("transitions");},transitions:function(e,g){var f=b.Deferred();b.each(e,function(d,h){if(!b.effects[h.fx]){f.reject('Effect "'+h.fx+'" does not exits. Did you include the jqeury.effect.'+h.fx+".js ? ",h);
return false;}h.el[g](h.fx,h.options,parseInt(h.speed,10),function(){if(g==="show"){h.el.addClass("fxApplied");}else{h.el.removeClass("fxApplied");}if(h.outGoto){var i=(h.outGoto==="self")?h.el:b(h.outGoto);
b.each(i,function(l,k){var j=b(k);if(j.is(":hidden")){b(j).tagimator("show");}else{b(j).tagimator("hide");}});}if(d==(e.length-1)){f.resolve(h);}});});
return f.promise();},createFxStack:function(e){var d={};e.each(function(f,h){var g=b(h);if(!d[g.attr("data-fx-step")]){d[g.attr("data-fx-step")]=[];}d[g.attr("data-fx-step")].push({el:g,fx:g.attr("data-fx"),speed:g.attr("data-fx-speed")?g.attr("data-fx-speed"):a.settings.speed,outGoto:g.attr("data-fx-out-goto")?g.attr("data-fx-out-goto"):null,options:{direction:g.attr("data-fx-direction"),easing:g.attr("data-fx-easing")?g.attr("data-fx-easing"):a.settings.easing}});
});return d;},reverseStack:function(f){var e={},h,d=[];for(h in f){if(f.hasOwnProperty(h)){d.push(h);}}d.reverse();var g=d.length;for(h=0;h<g;h++){e[h+1]=f[d[h]];
}return e;},renderSegments:function(e){var d=this;if(e.length>0){e.css({position:"relative",overflow:"hidden"});e.each(function(f,g){b(g).find(".tagimator-fragment").each(function(i,h){d.renderFragment(h);
});});}},renderFragment:function(e){var d=this.getGuid();b(e).attr("id","tagimator_"+d).addClass("fx-rendered");this.fetch(b(e).data("url"),d,function(f){b(e).append(f).tagimator("show");
});},fetch:function(f,e,g){var d=this;b.ajax({url:f,success:function(j){var h=j.replace(/<script.*?>[\s\S]*?<\/.*?script>/,"");var i=j.match(/<style.*?>[\s\S]*?<\/.?style>/)[0].replace(/(<style>|<?<\/style>)/,"");
var k=d.prefixCSS(i,"#tagimator_"+e);h=h.replace(/<style.*?>[\s\S]*?<\/.?style>/,"");b("head").find("style").append(k);g(h);},error:function(h,j,i){g("<p>can not render: "+f+"</p><p>reason: "+i+"</p>");
}});},prefixCSS:function(d,f){var e=/(=|"|\[|\]|\:|[a-z0-9_\-]|#|\.)(([_a-zA-Z0-9]|=|\[|\]|\"|\:|\.)*(\s)*([_a-zA-Z0-9-]|\[|\=|\"|\]\:|\.|#)*)(?=[^}]+\{)/gi;
return d.replace(e,f+" $1$2");},getGuid:function(){function d(){return(((1+Math.random())*65536)|0).toString(16).substring(1);}return(d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d());
}};b.fn.tagimator=function(d){if(a[d]){a.init.apply(this,Array.prototype.slice.call(arguments,1));return a[d].apply(this,Array.prototype.slice.call(arguments,1));
}else{if(typeof d==="object"||!d){return a.init.apply(this,arguments);}else{b.error("Method "+d+" does not exist on jQuery.tagimator");}}};if(b(".tagimator-segment").not(".fx-rendered").length>0){a.renderSegments(b(".tagimator-segment").not(".fx-rendered"));
}})(jQuery);